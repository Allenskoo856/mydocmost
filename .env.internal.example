# 内网部署环境变量配置示例
# 本文件用于内网/离线环境部署，已移除所有云服务和外网依赖

# ========== 基础配置 ==========
# 您的内网域名
APP_URL=http://your-internal-domain.com
PORT=3000

# 应用密钥(必须设置，至少32字符)
# 生成命令: openssl rand -hex 32
APP_SECRET=REPLACE_WITH_LONG_SECRET_MIN_32_CHARS

# JWT过期时间
JWT_TOKEN_EXPIRES_IN=30d

# ========== 数据库配置 ==========
DATABASE_URL="postgresql://postgres:password@localhost:5432/docmost?schema=public"
DATABASE_MAX_POOL=10

# ========== Redis配置 ==========
REDIS_URL=redis://127.0.0.1:6379

# ========== 云服务配置 (内网部署请设置为false) ==========
# 禁用云服务功能，隐藏Billing/License/SSO等企业版功能
CLOUD=false

# ========== 存储配置 ==========
# 选项: local (本地存储) | s3 (对象存储)
STORAGE_DRIVER=local

# 如使用S3兼容存储(如MinIO内网部署):
# AWS_S3_ACCESS_KEY_ID=your_access_key
# AWS_S3_SECRET_ACCESS_KEY=your_secret_key
# AWS_S3_REGION=us-east-1
# AWS_S3_BUCKET=docmost
# AWS_S3_ENDPOINT=http://your-minio-server:9000
# AWS_S3_FORCE_PATH_STYLE=true

# ========== 文件大小限制 ==========
FILE_UPLOAD_SIZE_LIMIT=50mb
FILE_IMPORT_SIZE_LIMIT=200mb

# ========== 邮件配置 ==========
# 选项: log (控制台输出，开发用) | smtp | postmark
MAIL_DRIVER=smtp
MAIL_FROM_ADDRESS=noreply@your-internal-domain.com
MAIL_FROM_NAME=Docmost

# SMTP配置(如使用内网邮件服务器)
SMTP_HOST=your-smtp-server.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_IGNORETLS=false
SMTP_USERNAME=your_smtp_username
SMTP_PASSWORD=your_smtp_password

# ========== 绘图工具配置 ==========
# 如果内网部署了Draw.io服务，请设置为内网地址
# 否则留空，将使用默认的embed.diagrams.net (需外网访问)
DRAWIO_URL=

# ========== 搜索配置 ==========
# 选项: database (PostgreSQL全文搜索) | typesense
SEARCH_DRIVER=database

# 如使用Typesense搜索引擎(可选):
# TYPESENSE_URL=http://your-typesense-server:8108
# TYPESENSE_API_KEY=your_typesense_api_key
# TYPESENSE_LOCALE=zh

# ========== 协作服务配置 ==========
# 实时协作WebSocket服务地址(通常与APP_URL相同)
# COLLAB_URL=http://your-internal-domain.com
# 如使用独立协作服务器:
# COLLAB_PORT=3001
# COLLAB_DISABLE_REDIS=false

# ========== AI功能配置 (可选，需额外配置) ==========
# 选项: openai | gemini | ollama
# AI_DRIVER=ollama
# AI_EMBEDDING_MODEL=nomic-embed-text
# AI_COMPLETION_MODEL=llama3
# AI_EMBEDDING_DIMENSION=768

# Ollama配置(推荐内网部署):
# OLLAMA_API_URL=http://your-ollama-server:11434

# OpenAI配置(需外网或内网代理):
# OPENAI_API_KEY=your_openai_api_key
# OPENAI_API_URL=https://api.openai.com/v1

# ========== 子域名配置 (可选) ==========
# 如果使用子域名作为工作区地址(如tenant1.docmost.com)
# SUBDOMAIN_HOST=docmost.com

# ========== 安全与审计 ==========
# 内网部署建议:
# 1. 使用HTTPS (配置Nginx/Caddy反向代理)
# 2. 定期备份数据库
# 3. 限制数据库和Redis只允许本地访问
# 4. 定期更新依赖包安全补丁

# ========== 部署检查清单 ==========
# [x] APP_SECRET 已生成并设置
# [x] DATABASE_URL 正确配置
# [x] REDIS_URL 正确配置
# [x] CLOUD=false (禁用云服务)
# [x] DISABLE_TELEMETRY=true (禁用遥测)
# [x] MAIL_DRIVER 配置内网邮件服务
# [x] STORAGE_DRIVER 根据需要选择local或s3
# [ ] 数据库已初始化(pnpm --filter ./apps/server run migration:latest)
# [ ] 前端已构建(pnpm client:build)
# [ ] 后端已构建(pnpm server:build)
